<div class="post-detail-container">
  <!-- Loading spinner -->
  <div class="loading-spinner" *ngIf="isLoading">
    <mat-spinner></mat-spinner>
  </div>

  <!-- Post content -->
  <div *ngIf="post && !isLoading">
    <!-- ... (keep existing post header and content sections unchanged) ... -->

    <!-- Comments section -->
    <div class="comments-section">
      <h2>Comments ({{ comments.length }})</h2>

      <!-- ... (keep existing filter and sort sections unchanged) ... -->

      <!-- Enhanced comment form with speech recognition -->
      <div class="comment-form">
        <div class="comment-input-container">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Add a comment</mat-label>
            <textarea 
              id="comment-textarea"
              matInput 
              [(ngModel)]="newCommentContent" 
              (input)="autoResizeTextarea($event)"
              rows="3" 
              placeholder="Share your thoughts..."
              maxlength="5000">
            </textarea>
            <mat-hint align="end">{{ newCommentContent.length }}/5000</mat-hint>
          </mat-form-field>
          
          <!-- Speech recognition button for comments -->
          <div class="speech-controls">
            <button 
              mat-icon-button 
              (click)="startRecordingForComment()"
              [disabled]="isSubmittingComment || !isSpeechRecognitionSupported"
              [matTooltip]="isRecordingComment ? 'Stop recording' : 'Start voice input'"
              [color]="isRecordingComment ? 'warn' : 'primary'">
              <mat-icon>{{ isRecordingComment ? 'mic_off' : 'mic' }}</mat-icon>
            </button>
            
            <!-- Recording indicator -->
            <div class="recording-indicator" *ngIf="isRecordingComment">
              <div class="pulse-dot"></div>
              <span class="recording-text">Recording...</span>
            </div>
          </div>
        </div>

        <div class="comment-form-actions">
          <button 
            mat-raised-button 
            color="primary" 
            (click)="addComment()" 
            [disabled]="!newCommentContent.trim() || isSubmittingComment || isRecordingComment">
            <mat-icon>send</mat-icon>
            <span *ngIf="!isSubmittingComment">Post Comment</span>
            <span *ngIf="isSubmittingComment">Posting...</span>
          </button>
          
          <!-- Speech recognition support indicator -->
          <div class="speech-support-info" *ngIf="!isSpeechRecognitionSupported">
            <mat-icon color="warn">warning</mat-icon>
            <small>Voice input not supported</small>
          </div>
        </div>
      </div>

      <!-- Comments loading indicator -->
      <div class="loading-comments" *ngIf="isLoadingComments">
        <mat-spinner diameter="30"></mat-spinner>
        <span>Loading comments...</span>
      </div>

      <!-- Enhanced Comments list -->
      <div class="comments-list" *ngIf="!isLoadingComments && filteredComments.length > 0; else noComments">
        <div class="comment" *ngFor="let comment of filteredComments">
          <!-- ... (keep existing comment display sections unchanged) ... -->

          <!-- Enhanced Reply form with speech recognition -->
          <div class="reply-form" *ngIf="replyingToCommentId === comment.id">
            <div class="reply-input-container">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Write a reply</mat-label>
                <textarea 
                  id="reply-textarea"
                  matInput 
                  [(ngModel)]="replyContent" 
                  (input)="autoResizeTextarea($event)"
                  rows="2" 
                  placeholder="Write your reply..."
                  maxlength="5000">
                </textarea>
                <mat-hint align="end">{{ replyContent.length }}/5000</mat-hint>
              </mat-form-field>
              
              <!-- Speech recognition button for replies -->
              <div class="speech-controls">
                <button 
                  mat-icon-button 
                  (click)="startRecordingForReply()"
                  [disabled]="isSubmittingReply || !isSpeechRecognitionSupported"
                  [matTooltip]="isRecordingReply ? 'Stop recording' : 'Start voice input'"
                  [color]="isRecordingReply ? 'warn' : 'primary'">
                  <mat-icon>{{ isRecordingReply ? 'mic_off' : 'mic' }}</mat-icon>
                </button>
                
                <!-- Recording indicator for replies -->
                <div class="recording-indicator" *ngIf="isRecordingReply">
                  <div class="pulse-dot"></div>
                  <span class="recording-text">Recording...</span>
                </div>
              </div>
            </div>
            
            <div class="reply-actions">
              <button mat-button (click)="cancelReply()">
                <mat-icon>cancel</mat-icon>
                Cancel
              </button>
              <button 
                mat-raised-button 
                color="primary" 
                (click)="submitReply()" 
                [disabled]="!replyContent.trim() || isSubmittingReply || isRecordingReply">
                <mat-icon>send</mat-icon>
                <span *ngIf="!isSubmittingReply">Post Reply</span>
                <span *ngIf="isSubmittingReply">Posting...</span>
              </button>
            </div>
          </div>

          <!-- ... (keep existing replies section unchanged) ... -->
        </div>
      </div>

      <ng-template #noComments>
        <div class="no-comments">
          <mat-icon>comment</mat-icon>
          <p>No comments yet. Be the first to comment!</p>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Error state -->
  <div class="error-state" *ngIf="!post && !isLoading">
    <mat-icon>error_outline</mat-icon>
    <h2>Post not found</h2>
    <p>The post you're looking for doesn't exist or has been removed.</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Go Back
    </button>
  </div>
</div>